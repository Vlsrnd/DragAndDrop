(()=>{var e={353:e=>{e.exports='<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Drag and drop</title> </head> <body> <div class="start hide"> <button class="start__btn">start</button> </div> <div class="container"> <header class="header"> <div class="header-btn header-btn__draw" data-btn="draw-mode"></div> <div class="header-btn header-btn__new-element" data-btn="new-element"></div> <h1>treeCreator</h1> <div class="header-btn header-btn__settings" data-btn="settings"></div> <div class="header-btn header-btn__trash" data-btn="trash"></div> <div class="settings"> <div class="settings-switch__mode hide"> <div class="settings-switch__mode-active" data-btn="BG-settings">BG</div> <div data-btn="LINE-settings">LINE</div> </div> <div class="colors__palette"> <canvas id="canvas-palette"></canvas> <div class="colors__palette-marker"></div> </div> <div class="example"> <div class="example__line"></div> </div> <div class="line-width-slider"> <div class="line"></div> <div class="marker"></div> </div> <div class="exit-btn"></div> </div> </header> <div class="structure"> <div class="draw-area"> <div class="draw-area__bg"></div> <canvas class="canvas" id="canvas-bg"></canvas> <canvas class="canvas" id="canvas-draw"></canvas> </div> </div> <footer class="footer">footer</footer> </div>  </body> </html>'}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}(()=>{"use strict";var e=function(e,t){e.setAttribute("width",t.clientWidth),e.setAttribute("height",t.clientHeight)},t=(n(353),function(e){var t=document.createElement("div");return t.classList.add("element"),t.dataset.func="element",t.dataset.deleted="false",t.innerHTML=e,t}),r='<div class="element__text" data-func="element">new</div><input class="element__input hide" type="text"></input><div class="element__btn element__btn-remove" data-func="remove" title="remove">&#10008;</div><div class="element__btn element__btn-create" data-func="create" title="create">+</div><div class="element__btn element__btn-edit" data-func="edit" title="edit">&#9998;</div><div class="element__btn element__btn-info" data-func="info" title="info">i</div>',i=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n){var r=t.filter((function(e){return e.element===n}))[0];r.children.push(e)}t.push({element:e,children:[]})},o=function(e,t,n){var r=t.clientX-n.offsetLeft-e.clientWidth/2,i=t.clientY-n.offsetTop-e.clientHeight/2;e.style.left=Math.max(0,Math.min(r,n.clientWidth-e.clientWidth))+"px",e.style.top=Math.max(0,Math.min(i,n.clientHeight-e.clientHeight))+"px"};function a(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d=function(e,t,n,r){return t.clearRect(0,0,e.width,e.height),t.lineWidth=r.lineWidth,t.strokeStyle=r.lineColor,n.forEach((function(n){t.beginPath(),t.moveTo(n[0][0]-e.offsetLeft,n[0][1]-e.offsetTop),t.lineTo(n[1][0]-e.offsetLeft,n[1][1]-e.offsetTop),t.closePath(),t.stroke()})),!0},l={subscribe:function(e,t){this[e]=t},redraw:null,_lineWidth:10,set lineWidth(e){this._lineWidth=e,this.redraw()},get lineWidth(){return this._lineWidth},_colorBG:"#fff",set colorBG(e){this._colorBG=e,drawAreaBG.style.backgroundColor=this._colorBG},get colorBG(){return this._colorBG},_lineColor:"red",set lineColor(e){this._lineColor=e,this.redraw()},get lineColor(){return this._lineColor},drawMode:{color:"#000",lineWidth:1},isDrawMode:!1,settingsMode:null},c={elementsCollection:[],trashCollection:[],elementsCoordinate:[],drawModeCoordinate:[]};function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var m=function(e,t,n){switch(n.settingsMode){case"DRAW":case"LINE":t.style.borderColor=n.drawMode.color,t.style.borderWidth=n.drawMode.lineWidth+"px",t.style.transform="translateY(-".concat(n.drawMode.lineWidth/2,"px)");break;case"BG":e.style.backgroundColor=n.colorBG;break;default:console.log("Something went wrong in updateExample. Settings mode is ".concat(n.settingsMode))}},h=function(e,t,n){var r=t.querySelector(".settings-switch__mode"),i=t.querySelector(".line-width-slider");switch(e.settingsMode=n,n){case"DRAW":r.classList.add("hide"),i.classList.remove("hide");break;case"BG":r.classList.remove("hide"),i.classList.add("hide");break;case"LINE":r.classList.remove("hide"),i.classList.remove("hide");break;default:console.error("Wrong property 'mode', you use '".concat(n," param"))}t.style.top=0},v=document.getElementById("canvas-draw").getContext("2d"),p=document.querySelector(".draw-area"),g=c.drawModeCoordinate,w=function(){return function(e,t){for(var n=0;n<t.length;n++)t[n].color?(e.lineWidth=t[n].lineWidth,e.strokeStyle=t[n].color,e.beginPath()):t[n-1].color?e.moveTo(t[n][0],t[n][1]):e.lineTo(t[n][0],t[n][1]);return e.stroke(),!0}(v,g)},y=function(e){g.push([e.clientX-p.offsetLeft,e.clientY-p.offsetTop]),requestAnimationFrame(w)};window.requestAnimationFrame(w);var b=function(){g.push({color:l.drawMode.color,lineWidth:l.drawMode.lineWidth}),p.addEventListener("mousemove",y)},E=function(){p.removeEventListener("mousemove",y)},_=function(){var e=document.getElementById("canvas-palette"),t=e.getContext("2d"),n=document.querySelector(".draw-area"),r=document.querySelector(".header"),i=document.querySelector(".settings"),o=document.querySelector(".colors__palette-marker"),a=document.querySelector(".example"),s=a.querySelector(".example__line");!function(e,t){e.setAttribute("width",e.parentElement.clientWidth),e.setAttribute("height",e.parentElement.clientHeight);var n=t.createLinearGradient(0,0,e.width,0);n.addColorStop(0,"#000"),n.addColorStop(.03,"#000"),n.addColorStop(.04,"#fff"),n.addColorStop(.07,"#fff");for(var r=.2,i=0;r<=1;r+=.1,i+=45)n.addColorStop(r,"hsl(".concat(i,", 50%, 50%)")),n.addColorStop(r-.02,"hsl(".concat(i,", 100%, 50%)"));t.fillStyle=n,t.fillRect(0,0,e.width,e.height)}(e,t);var d=function(n){!function(e,t,n,r,i){var o=e.clientX-t.parentElement.offsetLeft,a=e.clientY-t.parentElement.offsetTop;i.style.left=o-i.clientWidth+"px",i.style.top=a-i.clientHeight+"px";var s=u(n.getImageData(o,a,1,1).data,4),d=s[0],l=s[1],c=s[2],f=s[3],m="rgba(".concat(d,", ").concat(l,", ").concat(c,", ").concat(f,")");switch(r.settingsMode){case"DRAW":r.drawMode.color=m;break;case"BG":r.colorBG=m;break;case"LINE":r.lineColor=m;break;default:console.log("Something went wrong in selectColor. Settings mode is ".concat(r.settingsMode))}}(n,e,t,l,o),m(a,s,l)};e.parentElement.addEventListener("mousedown",(function(t){d(t),e.addEventListener("mousemove",d)})),e.parentElement.addEventListener("mouseup",(function(t){e.removeEventListener("mousemove",d)}));var c=document.querySelector(".line-width-slider"),f=function(e){!function(e,t,n){t.preventDefault();var r=e.querySelector(".line"),i=e.querySelector(".marker"),o=t.clientX-e.offsetLeft-i.clientWidth/2;o=Math.max(0,Math.min(r.clientWidth-i.clientWidth,o)),i.style.left=o+"px";var a=String(Math.round(o/r.clientWidth*10+1));switch(n.settingsMode){case"DRAW":n.drawMode.lineWidth=a;break;case"LINE":n.lineWidth=a;break;default:console.log("Something went wrong in slide-line-width. Settings mode is ".concat(n.settingsMode))}}(c,e,l),m(a,s,l)};document.addEventListener("mousedown",(function(e){e.target.parentElement===c&&(f(e),document.addEventListener("mousemove",f))})),document.addEventListener("mouseup",(function(){document.removeEventListener("mousemove",f)})),document.querySelector(".settings .exit-btn").onclick=function(){l.isDrawMode=!1,function(e){e.style.top="-".concat(e.clientHeight,"px")}(i),n.removeEventListener("mousedown",b),n.removeEventListener("mouseup",E)},r.addEventListener("click",(function(e){switch(e.target.dataset.btn){case"draw-mode":l.isDrawMode=!0,h(l,i,"DRAW"),n.addEventListener("mousedown",b),n.addEventListener("mouseup",E);break;case"settings":case"BG-settings":h(l,i,"BG");break;case"LINE-settings":h(l,i,"LINE")}}))};function L(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var W=document.querySelector(".draw-area"),M=document.querySelector(".draw-area__bg"),A=document.getElementById("canvas-bg"),C=A.getContext("2d"),x=document.getElementById("canvas-draw"),k=c.elementsCollection,I=c.trashCollection,B=c.elementsCoordinate;l.subscribe("redraw",(function(){return d(A,C,B,l)})),window.drawAreaBG=M,window.store=c,window.mainSettings=l;var q=function(){B.length=0,B.push.apply(B,L(function(e){if(e.length<2)return[];var t=[];return e.forEach((function(e){var n=[e.element.offsetLeft+e.element.clientWidth/2,e.element.offsetTop+e.element.clientHeight/2];e.children.forEach((function(e){"false"===e.dataset.deleted&&t.push([n,[e.offsetLeft+e.clientWidth/2,e.offsetTop+e.clientHeight/2]])}))})),t}(k))),d(A,C,B,l)};window.addEventListener("load",(function(){e(A,W),e(x,W);var n=t(r);n.ondragstart=function(){return!1},W.append(n),i(n,k),o(n,{clientX:W.clientWidth/2,clientY:10},W),_()})),document.addEventListener("mousedown",(function(e){if(!l.isDrawMode)if("create"===e.target.dataset.func||"new-element"===e.target.dataset.btn){var n="create"===e.target.dataset.func?e.target.parentElement:null,a=t(r);W.append(a),a.ondragstart=function(){return!1},o(a,e,W),i(a,k,n);var s=function(e){o(a,e,W),q()};document.addEventListener("mousemove",s),document.addEventListener("mouseup",(function(){document.removeEventListener("mousemove",s)}))}else if("element"===e.target.dataset.func){var d=e.target.parentElement,c=function(e){o(d,e,W),q()};document.addEventListener("mousemove",c),document.addEventListener("mouseup",(function(){document.removeEventListener("mousemove",c)}))}})),document.addEventListener("click",(function(e){var t,n,r,i;if(!l.isDrawMode)if("edit"===e.target.dataset.func)t=e.target.parentElement,n=t.querySelector(".element__input"),r=t.querySelector(".element__text"),i=a(t.querySelectorAll(".element__btn")),r.classList.add("hide"),n.classList.remove("hide"),i.forEach((function(e){return e.classList.add("hide")})),n.focus(),n.addEventListener("change",(function(){r.textContent=n.value,n.value="",r.classList.remove("hide"),n.classList.add("hide"),setTimeout((function(){return i.forEach((function(e){return e.classList.remove("hide")}))}),1e3)}),{once:!0});else if("remove"===e.target.dataset.func){var o=function(e,t){if(!(t.length<=1)){var n=t.filter((function(t){return t.element===e}))[0].children,r=[];return n.forEach((function(e){"false"===e.dataset.deleted&&(e.dataset.deleted=!0,e.classList.add("hide"),r.push(e))})),e.dataset.deleted=!0,e.classList.add("hide"),r.push(e),{time:new Date,deletedElements:r}}}(e.target.parentElement,k);I.push(o),q()}})),document.addEventListener("keydown",(function(e){"KeyZ"!==e.code||!e.ctrlKey&&!e.metaKey||l.isDrawMode||(I.length>0?(I.pop().deletedElements.forEach((function(e){e.classList.remove("hide"),e.dataset.deleted="false"})),q()):alert("trash basket is empty"))}));var T,G={width:W.clientWidth,height:W.clientHeight};window.addEventListener("resize",(function(){T||(T=setTimeout((function(){var t,n;T=null,e(A,W),e(x,W),t=G,n=W,k.forEach((function(e){var r=e.element;r.style.left=r.offsetLeft*(n.clientWidth/t.width)+"px",r.style.top=r.offsetTop*(n.clientHeight/t.height)+"px"})),t.width=n.clientWidth,t.height=n.clientHeight,q()}),30))}),!1)})()})();